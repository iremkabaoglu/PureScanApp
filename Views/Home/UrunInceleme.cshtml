@{
    ViewData["Title"] = "Ürün İnceleme";
    Layout = "_Layout";
}

<section style="padding: 60px; max-width: 1000px; margin: auto;">
    <h2 style="color: #5a2a83; text-align: center; margin-bottom: 40px;">Ürün İçerik Analizi</h2>

    <!-- Yükleme Formu -->
    <form id="uploadForm" enctype="multipart/form-data" style="text-align: center;">
        <input type="file" name="file" id="fileInput" required
               style="padding: 12px; border: 1px solid #ccc; border-radius: 8px;" />
        <button type="submit" style="
            margin-left: 20px;
            background: #9c4dcc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
        ">
            Yükle ve Analiz Et
        </button>
    </form>
    <div id="analysisWrapper" style="display: flex; gap: 40px; align-items: flex-start; margin-top: 40px; flex-wrap: wrap;">
        <div id="imagePreview" style="flex: 1; text-align: center;"></div>
        <div id="result" style="flex: 2;"></div>
    </div>
</section>

<script>
        document.getElementById("uploadForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const formData = new FormData();
        const fileInput = document.getElementById("fileInput");
        formData.append("file", fileInput.files[0]);

        // 🔍 Görseli göster
        const imagePreview = document.getElementById("imagePreview");
        const reader = new FileReader();
        reader.onload = function () {
            imagePreview.innerHTML = `<img src="${reader.result}" alt="Yüklenen Ürün" style="max-width: 300px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px;" />`;
        };
        reader.readAsDataURL(fileInput.files[0]);

        fetch("/api/product/upload", {
            method: "POST",
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            let html = `
                <div style="background: #f8f4fb; padding: 30px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h3 style="color: #5a2a83;">${data.productName}</h3>
                    <p style="margin-bottom: 20px;">Aşağıda ürünün içerik analiz sonucu yer almaktadır:</p>
                    <ul style="list-style: none; padding: 0;">
            `;
            data.ingredients.forEach(item => {
                let color = item.risk === "Yüksek" ? "#e74c3c" : item.risk === "Orta" ? "#f39c12" : "#2ecc71";
                html += `
                    <li style="background: ${color}; color: white; padding: 12px 20px; border-radius: 10px; margin-bottom: 10px;">
                        <strong>${item.name}</strong> – ${item.risk} risk
                    </li>
                `;
            });
            html += `</ul></div>`;
            document.getElementById("result").innerHTML = html;
        })
        .catch(err => {
            console.error(err);
            document.getElementById("result").innerText = "Hata oluştu.";
        });
    });

</script>
